#!/bin/bash
#
# Helps explore a repo
#
# So high, so low, so many things to know.
#
# There is a deepness in the sky, and it extends forever.

default_file_extension=".rs"
default_pl="Rust"

file_extension=${1:-$default_file_extension}
pl=${2:-$default_pl}

function main {
  echo "So high, so low, so many things to know"
  echo ""
  echo "File: $file_extension"
  echo "Code: $pl"
  echo ""

  ls -la | drop3 | filename | only_folders_and_rust | loc | sort -r

  echo ""
}

function drop3 {
  rb drop 3 < /dev/stdin
}

function filename {
  rb -l ' split(" ")[-1] ' < /dev/stdin
}

function only_folders_and_rust {
  rb "select { |l| !l.include?('.') || l.include?('$file_extension') }" < /dev/stdin
}

function loc {
  code=$(cat <<ruby
loc = \`tokei #{me}\`.split("\n")
  .select { |o| o.include?("$pl") }
  .map { |o| o.split(" ")[2] }
loc = loc.first || ""

"#{loc.rjust(20)} - #{me.ljust(20)}"
ruby
  )

  rb -l "$code" < /dev/stdin
}

# Most Modified Files
function mmf {
 git log --pretty=format: --name-only | sort | uniq -c | sort -rg | head -10
}

main

